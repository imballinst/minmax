<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover"
    />
    <meta name="title" content="MinMax Discount" />
    <meta
      name="description"
      content="Optimize the discount that you can get. Buy more to pay less!"
    />
    <meta name="keywords" content="discount, price" />
    <meta name="robots" content="all" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="author" content="imballinst" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />

    <!-- Google / Search Engine Tags -->
    <meta itemprop="name" content="MinMax Discount" />
    <meta
      itemprop="description"
      content="Optimize the discount that you can get. Buy more to pay less!"
    />
    <meta itemprop="image" content="./logo-transparent.png" />

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://password.apayak.xyz" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="MinMax Discount" />
    <meta
      property="og:description"
      content="Optimize the discount that you can get. Buy more to pay less!"
    />
    <meta property="og:image" content="./logo-transparent.png" />

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="MinMax Discount" />
    <meta
      name="twitter:description"
      content="Optimize the discount that you can get. Buy more to pay less!"
    />
    <meta name="twitter:image" content="./logo-transparent.png" />

    <!-- Fonts. -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bitter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Styles. -->
    <link rel="stylesheet" href="./css/tailwind.css" />

    <style>
      html,
      body {
        font-family: 'Bitter', serif;
      }
    </style>

    <title>MinMax Discount</title>
  </head>
  <body class="h-screen w-screen p-4">
    <div class="flex flex-col items-center">
      <h1 class="font-bold text-4xl mb-4">MinMax Discount</h1>

      <form id="minmax-form">
        <div class="shadow sm:rounded-md sm:overflow-hidden">
          <div class="px-4 py-5 bg-white space-y-6 sm:p-6">
            <fieldset>
              <label
                for="minimum-expense"
                class="block text-sm font-medium text-gray-700"
              >
                Minimal pembelian
              </label>
              <div class="mt-1 flex rounded-md shadow-sm">
                <span
                  class="
                    inline-flex
                    items-center
                    px-3
                    rounded-l-md
                    border border-r-0 border-gray-300
                    bg-gray-50
                    text-gray-500 text-sm
                  "
                >
                  Rp.
                </span>
                <input
                  type="text"
                  id="minimum-expense"
                  name="minimum-expense"
                  id="minimum-expense"
                  class="
                    focus:ring-teal-500 focus:border-teal-500
                    flex-1
                    rounded-none rounded-r-md
                    sm:text-sm
                    border-gray-300
                  "
                  required
                  placeholder="40000"
                />
              </div>
            </fieldset>

            <fieldset>
              <label
                for="discount-percentage"
                class="block text-sm font-medium text-gray-700"
              >
                Persentase diskon
              </label>
              <div class="mt-1 flex rounded-md shadow-sm w-24">
                <input
                  type="text"
                  id="discount-percentage"
                  name="discount-percentage"
                  id="discount-percentage"
                  class="
                    focus:ring-teal-500 focus:border-teal-500
                    flex-1
                    w-full
                    z-10
                    rounded-none rounded-l-md
                    border border-gray-300
                    sm:text-sm
                    border-gray-300
                    text-right
                  "
                  required
                  placeholder="30"
                />
                <span
                  class="
                    inline-flex
                    items-center
                    px-3
                    rounded-none rounded-r-md
                    border border-l-0 border-gray-300
                    bg-gray-50
                    text-gray-500 text-sm
                  "
                >
                  %
                </span>
              </div>
            </fieldset>

            <fieldset>
              <label
                for="maximum-discount"
                class="block text-sm font-medium text-gray-700"
              >
                Maksimal diskon
              </label>
              <div class="mt-1 flex rounded-md shadow-sm">
                <span
                  class="
                    inline-flex
                    items-center
                    px-3
                    rounded-l-md
                    border border-r-0 border-gray-300
                    bg-gray-50
                    text-gray-500 text-sm
                  "
                >
                  Rp.
                </span>
                <input
                  type="text"
                  id="maximum-discount"
                  name="maximum-discount"
                  id="maximum-discount"
                  class="
                    focus:ring-teal-500 focus:border-teal-500
                    flex-1
                    rounded-none rounded-r-md
                    sm:text-sm
                    border-gray-300
                  "
                  placeholder="25000"
                  required
                />
              </div>
            </fieldset>

            <button
              type="submit"
              class="
                inline-flex
                justify-center
                w-full
                py-2
                px-4
                border border-transparent
                shadow-sm
                rounded-md
                text-white
                font-bold
                bg-teal-500
                hover:bg-teal-600
                focus:outline-none
                focus:ring-2
                focus:ring-offset-2
                focus:ring-teal-500
              "
            >
              Hitung
            </button>
          </div>
        </div>
      </form>

      <div
        id="result"
        class="space-y-6 mt-8 hidden"
        role="region"
        aria-live="polite"
      >
        <h2 class="font-bold text-2xl mb-4 text-center">Diskon Optimal</h2>

        <p>
          Pengeluaran dengan kisaran
          <span class="font-medium" id="result-range-start"></span> hingga
          <span class="font-medium" id="result-range-end"></span>.
        </p>
      </div>
    </div>
  </body>

  <script>
    // Input percentage should only be numbers.
    const minimumExpenseInput = document.getElementById('minimum-expense');
    const percentageInput = document.getElementById('discount-percentage');
    const maximumDiscountInput = document.getElementById('maximum-discount');

    [minimumExpenseInput, percentageInput, maximumDiscountInput].forEach(
      (input) => {
        input.addEventListener('keydown', (e) => {
          // Allow all keys, except:
          // 1. the ones not numbers, or
          // 2. other keys, e.g. backspace, or
          // 3. ctrl key combinations, e.g. ctrl + v.
          if (
            e.keyCode > 31 &&
            (e.keyCode < 48 || e.keyCode > 57) &&
            !e.ctrlKey
          ) {
            e.preventDefault();
          }
        });
      }
    );

    // Form submit.
    const form = document.getElementById('minmax-form');
    const resultDiv = document.getElementById('result');
    const resultRangeStart = document.getElementById('result-range-start');
    const resultRangeEnd = document.getElementById('result-range-end');

    form.reset();
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const formData = new FormData(form);

      const minimumExpense = Number(formData.get('minimum-expense'));
      const percentage = Number(formData.get('discount-percentage'));
      const maximumDiscountValue = Number(formData.get('maximum-discount'));

      // Maximum discount.
      const optimalExpense = Math.floor(
        (maximumDiscountValue * 100) / percentage
      );

      // Modify DOM.
      resultDiv.classList.remove('hidden');
      resultRangeStart.innerHTML = `Rp.${minimumExpense}`;
      resultRangeEnd.innerHTML = `Rp.${optimalExpense}`;
    });
  </script>

  <!-- [remove-on-prod:start] -->
  <script src="./dev/socket.io.js"></script>

  <script>
    const socket = io('http://localhost:3000');
    socket.on('reload', (e) => {
      window.location.reload();
    });
  </script>
  <!-- [remove-on-prod:finish] -->
</html>
